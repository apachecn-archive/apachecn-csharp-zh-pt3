# 二十九、反模式

不讨论反模式，设计模式的讨论就不完整。下一章简要概述了反模式。我们开始吧。

## 概观

在现实世界的应用开发中，有时您可能会遵循一些在开始时非常吸引人的方法，但是从长远来看，它们会产生问题。例如，你可以尝试快速解决问题，以满足交货期限。但是如果你没有意识到潜在的陷阱，你可能需要为这些错误付出巨大的代价。

反模式提醒您可能导致问题的糟糕解决方案的常见错误，以便您可以采取预防措施。“预防胜于治疗”这句谚语适用于这种情况。

Points to Remember

反模式通过描述有吸引力的方法如何在将来使您的生活变得困难，提醒您常见的错误。与此同时，他们提出了一些替代解决方案，这些方案在开始时可能看起来很难，但最终会帮助你建立一个更好的解决方案。简而言之，反模式识别既定实践中的问题，它们可以将一般情况映射到特定类别的高效解决方案。他们还可以为你提供更好的计划来扭转一些不好的做法，使这些健康的解决方案。

## 反模式简史

设计模式的最初想法来自建筑建筑师克里斯托弗·亚历山大，他是伯克利的教授。他分享了在规划良好的城镇中建造建筑的想法。渐渐地，这些概念进入了软件开发，并通过像沃德·坎宁安和肯特·贝克这样的前沿软件开发人员而流行起来。1994 年，通过一个名为程序设计模式语言(PLoP)关于设计模式的行业会议，设计模式的思想进入了面向对象软件开发的主流。Hillside Group 主办了它，Jim Coplien 的论文“一种开发过程生成模式语言”因其上下文而闻名。随着 GoF 推出经典教材*Design Patterns:Elements of Reusable Object-Oriented Software*，设计模式的思想变得非常流行。

毫无疑问，这些伟大的设计模式帮助了(并且仍然在帮助)程序员开发高质量的软件。但在某些情况下，人们也开始注意到负面影响。这里有一个常见的例子。许多开发人员想要展示他们的专业知识，而没有对这些模式在他们特定领域的真实评估或结果。作为一个明显的副作用，模式被植入了错误的上下文，产生了低质量的软件，并最终导致了对开发人员或他们的组织的巨大惩罚。

因此，软件行业需要关注类似错误的负面后果，最终，反模式的思想得到了发展。许多专家开始在这一领域做出贡献，但是第一个结构良好的模型来自 Michael Akroyd 题为“反模式:针对对象误用的疫苗”的演讲这是 GoF 设计模式的对外观。

术语*反模式*随着威廉·布朗等人的书*反模式:重构软件、架构和危机中的项目*而流行起来。以下摘自该书。

> *因为反模式有如此多的贡献者，将反模式的最初想法分配给单一来源是不公平的。相反，反模式是补充设计模式运动和扩展设计模式模型的自然步骤。*

## 反模式的例子

这些是反模式及其背后的概念/思维模式的一些例子。

*   **过度使用模式**开发人员可能会不惜任何代价尝试使用模式，不管它是否合适。

*   **神类**试图用许多不相关的方法控制几乎一切的大物体。不恰当地使用中介模式可能会导致反模式。

*   **不是在这里发明的**我是一家大公司，我想从零开始打造一切。虽然已经有一个由另一家公司开发的库，但我不会使用它。我会自己做所有的东西，一旦开发出来，我会用我的品牌价值宣布，“嘿伙计们，终极图书馆已经为你们推出了。”

*   **零表示空**举个常见的例子，开发者认为没有人愿意在纬度零、经度零。另一种常见的变化是当程序员使用–1，999 或类似的数字来表示不合适的整数值。另一个错误的用例是用户在应用中将“09/09/9999”视为空日期。因此，在前面的例子中，如果用户需要数字-1 或 999，或者日期“09/09/9999”，他将得不到。

*   **金锤**X 先生相信技术 T 永远是最好的。所以，如果他需要开发一个新系统(这需要新的学习)，他会更喜欢 T，即使它不合适。他想，“我很忙。如果我能设法应付，我就不需要再学习任何技术了。”

*   **拍信使**我已经有压力了，节目截止日期快到了。测试人员 John 总是能找到难以修复的典型缺陷。另外，约翰不喜欢我，所以他喜欢在我的代码中寻找缺陷。所以，在这个阶段，我不想把他牵扯进来；他会发现更多的缺陷，而我会错过目标期限。

*   **瑞士军刀**对能够满足客户各种需求的产品的需求，比如可以治愈所有疾病的药物，为具有不同需求的广大客户服务的软件——界面有多复杂并不重要。

*   **复制粘贴编程**我需要解决一个问题，但我已经有了一段处理类似情况的代码。因此，我可以复制工作的旧代码，然后在需要时修改它。但是当你从一个现有的拷贝开始时，你基本上继承了所有与之相关的潜在缺陷。此外，如果将来需要修改原始代码，您需要在多个地方实现修改。这种做法也违反了*不重复自己*(干)的原则。

*   **架构师不编码**我是一名架构师。我的时间很宝贵。我只展示路径或做关于编码的精彩讲座。有足够多的实施者应该实施我的想法。*架构师打高尔夫*也是这个反模式的姐妹。

*   **隐藏和悬停**不要显示所有编辑或删除链接，直到用户悬停在元素上。

*   **伪装的链接和广告**愚弄你的用户，当他们点击一个链接或一个广告时，他们就获得收入，尽管他们不能得到他们想要的。

*   **数字管理**提交次数越多，代码行数越多，或者缺陷修复量越大，都是优秀开发人员的标志。

> *用代码行来衡量编程进度，就像用重量来衡量飞机制造进度。*
> 
> —比尔·盖茨

Points to Note

*   如今，您可以从不同的网站/来源了解各种反模式；比如 [`https://en.wikipedia.org/wiki/Anti-pattern`](https://en.wikipedia.org/wiki/Anti-pattern) 。

*   您还可以在 [`http://wiki.c2.com/?AntiPatternsCatalog`](http://wiki.c2.com/%253FAntiPatternsCatalog) 获得反模式目录的详细列表。

*   您可能还会注意到，反模式的概念并不局限于面向对象的编程。

## 反模式的类型

反模式可以属于不同的类别。甚至一个典型的反模式也可以属于多个类别。以下是一些常见的分类。

*   架构反模式瑞士军刀反模式就是这一类的例子。

*   **开发反模式**上帝类，过度使用模式就是这一类的例子。

*   **管理反模式**拍摄信使反模式就属于这一类。

*   **组织反模式**架构师不编码，打高尔夫的架构师属于这一类。

*   **用户界面反模式**的例子包括伪装的链接/广告。

Note

伪装的链接/广告也被称为暗模式。

## 问答环节

**29.1 反模式与** **设计模式** **有什么关系？**

当你使用设计模式时，你重用了在你之前的人的经验。当你开始仅仅为了使用而盲目地使用这些概念时，你就陷入了*重复使用循环解决方案*的陷阱。这可能会导致您以后陷入糟糕的境地，然后您会发现您的投资回报率(ROI)在下降，但维护成本却在增加。简单来说，简单而有吸引力的解决方案(或模式)可能会在将来给你带来更多的问题。

29.2 设计模式可能会变成反模式。这是正确的吗？

是的，如果你在一个错误的环境中应用一个设计模式，会导致比它所解决的问题更多的麻烦，最终它会变成一个反模式。所以，在你开始之前，理解问题的本质和背景是非常重要的。

29.3 反模式仅与软件开发人员相关。这是正确的吗？

不。反模式的用处不仅限于开发人员。它可能适用于其他人；例如，它对管理人员和技术架构师也很有用。

29.4 即使你现在没有从反模式中获得太多好处，这些也可以帮助你在将来以更低的维护成本轻松地适应新的特性。这是正确的吗？

是的。

**29.5 反模式的** **原因** **可能有哪些？**

它们可能来自不同的来源或心态。下面列出了一些某人可能会说(或想)的常见例子。

*   “我们需要尽快交付产品。”

*   “我们与客户的关系非常好。因此，目前我们不需要分析未来的影响。”

*   “我是重用专家。我非常了解设计模式。”

*   “我们使用最新的技术和功能来打动我们的客户。我们不需要担心遗留系统。”

*   "更复杂的代码反映了我在这方面的专业知识."

**29.6 你能列出一些反模式的** **症状** **吗？**

在面向对象编程(OOP)中，最常见的症状是您的系统不容易适应新的特性。此外，维护成本持续增加。您可能还会注意到，您已经失去了关键的面向对象特性的能力，比如继承、多态等等。

除此之外，您可能会看到以下症状。

*   全局变量的使用

*   代码复制

*   有限/没有代码重用

*   一大类(神类)

*   大量的无参数方法等。

29.7 如果检测到反模式，有什么补救措施？

你可能需要重构你的代码，找到一个更好的解决方案。例如，以下是一些针对以下反模式的解决方案。

*   **金锤**试着通过一些适当的训练来教育 X 先生。

*   **零表示空值**使用一个额外的布尔变量，对你来说更明智的是正确地表示空值。

*   数字管理如果你明智地使用数字，数字就是好的。你不能根据一个程序员每周修复的缺陷数量来判断他的能力。质量也很重要。一个典型的例子是，修复一个简单的 UI 布局比修复系统中严重的内存泄漏要容易得多。考虑另一个例子。“大量测试通过”并不意味着您的系统更加稳定，除非这些测试使用不同的代码路径/分支。

*   **拍摄信使**欢迎测试员约翰，并立即让他参与进来。不要把他当作你的对手。你可以适当地分析他的发现，并尽早修复真正的缺陷，以避免最后一刻的惊喜。

*   **复制粘贴编程**你可以重构代码，而不是寻找快速的解决方案。您还可以创建一个公共位置来维护常用的方法，以避免重复并使维护更容易。

*   **架构师不编码**让架构师参与实现阶段的某些部分。这对组织和架构师都有帮助。这让他们对产品的真正功能有了更清晰的了解。这个过程也有助于他们重视你的努力。

**29.8 什么叫** ***重构*** **？**

在编码领域，术语*重构*意味着改进现有代码的设计，而不改变系统/应用的外部行为。这个过程有助于您获得更具可读性的代码。同时，这些代码应该更能适应新的需求(或者变更请求)，并且更易于维护。